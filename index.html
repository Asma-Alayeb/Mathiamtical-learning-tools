function drawGraph() {
    const a = parseFloat(aInput.value);
    const b = parseFloat(bInput.value);
    const h = parseFloat(hInput.value);
    const k = parseFloat(kInput.value);

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw grid
    ctx.strokeStyle = '#e0e0e0';
    for (let x = 0; x <= canvas.width; x += 20) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
    }
    for (let y = 0; y <= canvas.height; y += 20) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
    }

    // Draw x and y axis
    ctx.strokeStyle = 'black';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(0, canvas.height / 2);
    ctx.lineTo(canvas.width, canvas.height / 2);
    ctx.moveTo(canvas.width / 2, 0);
    ctx.lineTo(canvas.width / 2, canvas.height);
    ctx.stroke();

    // Add numbers to the axes
    ctx.font = '12px Arial';
    ctx.fillStyle = 'black';

    // X-axis numbers
    for (let x = -canvas.width / 2; x <= canvas.width / 2; x += 40) {
        const canvasX = canvas.width / 2 + x;
        ctx.fillText(x / 20, canvasX, canvas.height / 2 + 15);
    }

    // Y-axis numbers
    for (let y = -canvas.height / 2; y <= canvas.height / 2; y += 40) {
        const canvasY = canvas.height / 2 - y;
        if (y !== 0) { // Avoid drawing "0" twice
            ctx.fillText(y / 20, canvas.width / 2 + 5, canvasY + 3);
        }
    }

    // Get the function input
    let userFunction;
    try {
        const userInput = parseFunction(functionInput.value);
        userFunction = new Function('x', 'return ' + userInput);
    } catch (e) {
        latexDisplay.innerHTML = "Invalid function. Please enter a valid function.";
        MathJax.Hub.Queue(["Typeset", MathJax.Hub, latexDisplay]);
        return;
    }

    // Update and display the formula in LaTeX
    const latexFormula = `g(x) = ${a} \\cdot f(${b}x - ${h}) + ${k}`;
    latexDisplay.innerHTML = `\\(${latexFormula}\\)`;
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, latexDisplay]);

    // Draw the transformed function
    ctx.strokeStyle = 'blue';
    ctx.lineWidth = 2;
    ctx.beginPath();

    const step = 0.1;
    for (let x = -canvas.width / 2; x <= canvas.width / 2; x += step) {
        const transformedX = (x / 20 + h) / b;
        const y = a * userFunction(transformedX) + k;

        const canvasX = canvas.width / 2 + x;
        const canvasY = canvas.height / 2 - y * 20;

        if (x === -canvas.width / 2) {
            ctx.moveTo(canvasX, canvasY);
        } else {
            ctx.lineTo(canvasX, canvasY);
        }
    }
    ctx.stroke();
}
